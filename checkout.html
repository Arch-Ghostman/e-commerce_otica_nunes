<!DOCTYPE html>
<html lang="pt-BR">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Finalizar Compra - VisionMax</title>

  <!--
    - favicon
  -->
  <link rel="shortcut icon" href="./assets/images/logo/favicon.ico" type="image/x-icon">

  <!--
    - custom css link
  -->
  <link rel="stylesheet" href="./assets/css/style-prefix.css">
  <link rel="stylesheet" href="./css/cart.css">

  <!--
    - google font link
  -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap"
    rel="stylesheet">

  <style>
    body {
      background-color: var(--cultured);
      font-family: 'Poppins', sans-serif;
    }

    .checkout-wrapper {
      min-height: 100vh;
      padding: 20px 0;
    }

    .checkout-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .checkout-header {
      background: var(--white);
      padding: 30px;
      border-radius: var(--border-radius-md);
      box-shadow: 0 2px 10px hsla(0, 0%, 0%, 0.1);
      margin-bottom: 30px;
      text-align: center;
    }

    .checkout-header h1 {
      color: var(--eerie-black);
      font-size: var(--fs-1);
      font-weight: var(--weight-600);
      margin-bottom: 10px;
    }

    .checkout-header p {
      color: var(--sonic-silver);
      font-size: var(--fs-6);
    }

    .checkout-content {
      display: grid;
      grid-template-columns: 1fr 400px;
      gap: 30px;
    }

    .checkout-form {
      background: var(--white);
      padding: 30px;
      border-radius: var(--border-radius-md);
      box-shadow: 0 2px 10px hsla(0, 0%, 0%, 0.1);
    }

    .order-summary {
      background: var(--white);
      padding: 30px;
      border-radius: var(--border-radius-md);
      box-shadow: 0 2px 10px hsla(0, 0%, 0%, 0.1);
      height: fit-content;
      position: sticky;
      top: 20px;
    }

    .form-section {
      margin-bottom: 40px;
    }

    .form-section:last-child {
      margin-bottom: 0;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: var(--weight-500);
      color: var(--eerie-black);
      font-size: var(--fs-6);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 15px;
      border: 1px solid var(--cultured);
      border-radius: var(--border-radius-sm);
      font-size: var(--fs-6);
      font-family: inherit;
      transition: var(--transition-timing);
      background: var(--white);
    }

    .form-group input:focus,
    .form-group select:focus,
    .form-group textarea:focus {
      outline: none;
      border-color: var(--salmon-pink);
      box-shadow: 0 0 0 3px hsla(353, 100%, 78%, 0.2);
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    .radio-group {
      display: flex;
      gap: 20px;
      margin-top: 10px;
      flex-wrap: wrap;
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 12px 20px;
      border: 1px solid var(--cultured);
      border-radius: var(--border-radius-sm);
      cursor: pointer;
      transition: var(--transition-timing);
      background: var(--white);
    }

    .radio-option:hover {
      border-color: var(--salmon-pink);
    }

    .radio-option input[type="radio"] {
      width: auto;
      margin: 0;
    }

    .radio-option input[type="radio"]:checked + label,
    .radio-option:has(input[type="radio"]:checked) {
      border-color: var(--salmon-pink);
      background: hsla(353, 100%, 78%, 0.1);
    }

    .radio-option label {
      margin: 0;
      cursor: pointer;
      font-size: var(--fs-7);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .radio-option label ion-icon {
      font-size: 1.1em;
      color: var(--salmon-pink);
    }

    .order-summary h3 {
      color: var(--eerie-black);
      font-size: var(--fs-3);
      font-weight: var(--weight-600);
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--cultured);
    }

    .order-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--cultured);
    }

    .order-item:last-child {
      border-bottom: none;
      margin-bottom: 0;
    }

    .item-info {
      flex: 1;
    }

    .item-name {
      font-weight: var(--weight-500);
      color: var(--eerie-black);
      font-size: var(--fs-7);
      margin-bottom: 5px;
    }

    .item-quantity {
      color: var(--sonic-silver);
      font-size: var(--fs-8);
    }

    .item-price {
      font-weight: var(--weight-600);
      color: var(--eerie-black);
      font-size: var(--fs-7);
    }

    .order-total {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-weight: var(--weight-700);
      font-size: var(--fs-4);
      margin-top: 20px;
      padding-top: 20px;
      border-top: 2px solid var(--eerie-black);
      color: var(--eerie-black);
    }

    .submit-btn {
      width: 100%;
      padding: 15px;
      background: var(--salmon-pink);
      color: var(--white);
      border: none;
      border-radius: var(--border-radius-sm);
      font-size: var(--fs-5);
      font-weight: var(--weight-600);
      cursor: pointer;
      transition: var(--transition-timing);
      font-family: inherit;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
    }

    .submit-btn ion-icon {
      font-size: 1.2em;
    }

    .submit-btn:hover {
      background: var(--bittersweet);
      transform: translateY(-2px);
      box-shadow: 0 4px 15px hsla(0, 100%, 70%, 0.3);
    }

    .form-section h2 {
      color: var(--eerie-black);
      font-size: var(--fs-3);
      font-weight: var(--weight-600);
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--cultured);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .form-section h2 ion-icon {
      font-size: 1.3em;
      color: var(--salmon-pink);
    }

    .back-btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 20px;
      padding: 12px 20px;
      background: var(--white);
      color: var(--eerie-black);
      text-decoration: none;
      border-radius: var(--border-radius-sm);
      transition: var(--transition-timing);
      box-shadow: 0 2px 10px hsla(0, 0%, 0%, 0.1);
      font-weight: var(--weight-500);
    }

    .back-btn:hover {
      background: var(--cultured);
      transform: translateY(-2px);
    }

    .empty-cart {
      text-align: center;
      padding: 40px 20px;
      color: var(--sonic-silver);
    }

    .empty-cart ion-icon {
      font-size: 4rem;
      margin-bottom: 20px;
      color: var(--cultured);
    }

    #endereco-section {
      margin-top: 20px;
      padding: 20px;
      background: var(--cultured);
      border-radius: var(--border-radius-sm);
      border-left: 4px solid var(--salmon-pink);
    }

    @media (max-width: 1024px) {
      .checkout-content {
        grid-template-columns: 1fr;
      }

      .order-summary {
        position: static;
        order: -1;
      }
    }

    @media (max-width: 768px) {
      .checkout-container {
        padding: 0 15px;
      }

      .checkout-header,
      .checkout-form,
      .order-summary {
        padding: 20px;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .radio-group {
        flex-direction: column;
        gap: 10px;
      }

      .radio-option {
        justify-content: flex-start;
      }
    }

    @media (max-width: 480px) {
      .checkout-wrapper {
        padding: 10px 0;
      }

      .checkout-header h1 {
        font-size: var(--fs-2);
      }

      .form-section h2 {
        font-size: var(--fs-4);
      }
    }
  </style>
</head>

<body>

  <div class="checkout-wrapper">
    <div class="checkout-container">
      <a href="javascript:history.back()" class="back-btn">
        <ion-icon name="arrow-back-outline"></ion-icon>
        Voltar ao Carrinho
      </a>
      
      <div class="checkout-header">
        <h1>Finalizar Compra</h1>
        <p>Preencha os dados abaixo para concluir seu pedido</p>
      </div>

      <div class="checkout-content">
        <div class="checkout-form">
          <form id="checkout-form">
            <div class="form-section">
              <h2>
                <ion-icon name="person-outline"></ion-icon>
                Dados Pessoais
              </h2>
              <div class="form-row">
                <div class="form-group">
                  <label for="nome">Nome Completo *</label>
                  <input type="text" id="nome" name="nome" required>
                </div>
                <div class="form-group">
                  <label for="cpf">CPF</label>
                  <input type="text" id="cpf" name="cpf" placeholder="000.000.000-00">
                </div>
              </div>
              <div class="form-row">
                <div class="form-group">
                  <label for="telefone">Telefone *</label>
                  <input type="tel" id="telefone" name="telefone" placeholder="(00) 00000-0000" required>
                </div>
                <div class="form-group">
                  <label for="email">E-mail</label>
                  <input type="email" id="email" name="email">
                </div>
              </div>
            </div>

            <div class="form-section">
              <h2>
                <ion-icon name="card-outline"></ion-icon>
                Forma de Pagamento
              </h2>
              <div class="form-group">
                <label>Selecione a forma de pagamento *</label>
                <div class="radio-group">
                  <div class="radio-option">
                    <input type="radio" id="dinheiro" name="pagamento" value="dinheiro" required>
                    <label for="dinheiro">
                      <ion-icon name="cash-outline"></ion-icon>
                      Dinheiro
                    </label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="pix" name="pagamento" value="pix" required>
                    <label for="pix">
                      <ion-icon name="qr-code-outline"></ion-icon>
                      PIX
                    </label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="cartao" name="pagamento" value="cartao" required>
                    <label for="cartao">
                      <ion-icon name="card-outline"></ion-icon>
                      Cartão
                    </label>
                  </div>
                </div>
              </div>
            </div>

            <div class="form-section">
              <h2>
                <ion-icon name="location-outline"></ion-icon>
                Entrega
              </h2>
              <div class="form-group">
                <label>Tipo de entrega *</label>
                <div class="radio-group">
                  <div class="radio-option">
                    <input type="radio" id="retirada" name="entrega" value="retirada" required>
                    <label for="retirada">
                      <ion-icon name="storefront-outline"></ion-icon>
                      Retirada no Local
                    </label>
                  </div>
                  <div class="radio-option">
                    <input type="radio" id="entrega-domicilio" name="entrega" value="entrega" required>
                    <label for="entrega-domicilio">
                      <ion-icon name="car-outline"></ion-icon>
                      Entrega em Domicílio
                    </label>
                  </div>
                </div>
              </div>

              <div id="endereco-section" style="display: none;">
                <div class="form-group">
                  <label for="endereco">Endereço Completo *</label>
                  <textarea id="endereco" name="endereco" rows="3" placeholder="Rua, número, bairro, cidade, CEP"></textarea>
                </div>
                <div class="form-row">
                  <div class="form-group">
                    <label for="cep">CEP</label>
                    <input type="text" id="cep" name="cep" placeholder="00000-000">
                  </div>
                  <div class="form-group">
                    <label for="referencia">Ponto de Referência</label>
                    <input type="text" id="referencia" name="referencia">
                  </div>
                </div>
              </div>
            </div>

            <div class="form-section">
              <h2>
                <ion-icon name="chatbubble-outline"></ion-icon>
                Observações
              </h2>
              <div class="form-group">
                <label for="observacoes">Observações Adicionais</label>
                <textarea id="observacoes" name="observacoes" rows="3" placeholder="Alguma observação especial sobre o pedido?"></textarea>
              </div>
            </div>

            <button type="submit" class="submit-btn">
              <ion-icon name="logo-whatsapp"></ion-icon>
              Enviar Pedido via WhatsApp
            </button>
          </form>
        </div>

        <div class="order-summary">
          <h3>Resumo do Pedido</h3>
          <div id="order-items">
            <!-- Items serão carregados aqui -->
          </div>
          <div class="order-total">
            <span>Total:</span>
            <span id="order-total">R$ 0,00</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Carregar dados do carrinho
    document.addEventListener('DOMContentLoaded', function() {
      loadOrderSummary();
      setupFormHandlers();
    });

    function loadOrderSummary() {
      const cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
      const orderItemsContainer = document.getElementById('order-items');
      const orderTotalElement = document.getElementById('order-total');
      
      if (cartItems.length === 0) {
        orderItemsContainer.innerHTML = `
          <div class="empty-cart">
            <ion-icon name="bag-outline"></ion-icon>
            <p>Nenhum item no carrinho</p>
          </div>
        `;
        return;
      }

      let total = 0;
      orderItemsContainer.innerHTML = '';

      cartItems.forEach(item => {
        const itemTotal = item.price * item.quantity;
        total += itemTotal;

        const orderItem = document.createElement('div');
        orderItem.className = 'order-item';
        orderItem.innerHTML = `
          <div class="item-info">
            <div class="item-name">${item.name}</div>
            <div class="item-quantity">Quantidade: ${item.quantity}</div>
          </div>
          <div class="item-price">R$ ${itemTotal.toFixed(2).replace('.', ',')}</div>
        `;
        orderItemsContainer.appendChild(orderItem);
      });

      orderTotalElement.textContent = `R$ ${total.toFixed(2).replace('.', ',')}`;
    }

    function setupFormHandlers() {
      // Mostrar/ocultar campos de endereço
      const entregaRadios = document.querySelectorAll('input[name="entrega"]');
      const enderecoSection = document.getElementById('endereco-section');
      
      entregaRadios.forEach(radio => {
        radio.addEventListener('change', function() {
          if (this.value === 'entrega') {
            enderecoSection.style.display = 'block';
            document.getElementById('endereco').required = true;
          } else {
            enderecoSection.style.display = 'none';
            document.getElementById('endereco').required = false;
          }
        });
      });

      // Máscara para CPF
      document.getElementById('cpf').addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d)/, '$1.$2');
        value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
        e.target.value = value;
      });

      // Máscara para CEP
      document.getElementById('cep').addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        value = value.replace(/(\d{5})(\d)/, '$1-$2');
        e.target.value = value;
      });

      // Máscara para telefone
      document.getElementById('telefone').addEventListener('input', function(e) {
        let value = e.target.value.replace(/\D/g, '');
        value = value.replace(/(\d{2})(\d)/, '($1) $2');
        value = value.replace(/(\d{5})(\d)/, '$1-$2');
        e.target.value = value;
      });

      // Envio do formulário
      document.getElementById('checkout-form').addEventListener('submit', function(e) {
        e.preventDefault();
        sendToWhatsApp();
      });
    }

    function sendToWhatsApp() {
      const formData = new FormData(document.getElementById('checkout-form'));
      const cartItems = JSON.parse(localStorage.getItem('cartItems')) || [];
      
      // Construir mensagem
      let message = '*🛍️ NOVO PEDIDO - VISIONMAX*\n\n';
      
      // Dados pessoais
      message += '*👤 DADOS DO CLIENTE:*\n';
      message += `Nome: ${formData.get('nome')}\n`;
      message += `Telefone: ${formData.get('telefone')}\n`;
      if (formData.get('email')) message += `E-mail: ${formData.get('email')}\n`;
      if (formData.get('cpf')) message += `CPF: ${formData.get('cpf')}\n`;
      
      // Itens do pedido
      message += '\n*🛒 ITENS DO PEDIDO:*\n';
      let total = 0;
      cartItems.forEach(item => {
        const itemTotal = item.price * item.quantity;
        total += itemTotal;
        message += `• ${item.name} (x${item.quantity}) - R$ ${itemTotal.toFixed(2).replace('.', ',')}\n`;
      });
      
      message += `\n*💰 TOTAL: R$ ${total.toFixed(2).replace('.', ',')}*\n`;
      
      // Forma de pagamento
      message += `\n*💳 PAGAMENTO:* ${formData.get('pagamento').toUpperCase()}\n`;
      
      // Entrega
      message += `\n*🚚 ENTREGA:* ${formData.get('entrega') === 'retirada' ? 'RETIRADA NO LOCAL' : 'ENTREGA EM DOMICÍLIO'}\n`;
      
      if (formData.get('entrega') === 'entrega') {
        message += `*📍 Endereço:* ${formData.get('endereco')}\n`;
        if (formData.get('cep')) message += `*CEP:* ${formData.get('cep')}\n`;
        if (formData.get('referencia')) message += `*Referência:* ${formData.get('referencia')}\n`;
      }
      
      // Observações
      if (formData.get('observacoes')) {
        message += `\n*📝 OBSERVAÇÕES:*\n${formData.get('observacoes')}\n`;
      }
      
      message += '\n_Pedido enviado através do site_';
      
      // Enviar para WhatsApp
      const phoneNumber = '5582996756984'; // Número com código do país
      const whatsappURL = `https://wa.me/${phoneNumber}?text=${encodeURIComponent(message)}`;
      
      // Limpar carrinho
      localStorage.removeItem('cartItems');
      
      // Redirecionar para WhatsApp
      window.open(whatsappURL, '_blank');
      
      // Mostrar confirmação e redirecionar
      alert('Pedido enviado! Você será redirecionado para o WhatsApp.');
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 2000);
    }
  </script>

  <!--
    - ionicon link
  -->
  <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
  <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

</body>

</html>